@startuml PineConePro_ERPIMS_C1
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

LAYOUT_WITH_LEGEND()

Person(owner, "Owner / GM", "Approves spending, monitors performance KPIs.")
Person(opsManager, "Operations Manager", "Oversees warehouse execution, shipping SLAs, cycle counts.")
Person(purchasingLead, "Purchasing Lead", "Plans replenishment, manages vendors, EOQ automation.")
Person(warehouseAssoc, "Warehouse Associate (RF)", "Executes receiving, put-away, picking, cycle counts.")
Person(csr, "Customer Service Rep", "Handles order exceptions, RMAs, customer status updates.")
Person(ecomManager, "E-Commerce Manager", "Maintains catalog, pricing, channel sync.")
Person(accountant, "Accountant", "Posts journals, reconciles AP/AR, files tax reports.")
Person(itAdmin, "IT Administrator", "Configures environments, RBAC, integrations.")
Person_Ext(b2bCustomer, "B2B Customer", "Browses catalog, places orders, tracks fulfillments via channels.")

System_Boundary(erpBoundary, "PineCone Pro ERP/IMS") {
  System(erp, "PineCone Pro ERP/IMS", "Angular SPA + ASP.NET Core modular monolith on Azure App Service; single source for product, inventory, orders, purchasing, shipping, tax, accounting, analytics.")
}

System_Ext(salesChannels, "Sales Channels Platform", "Web storefront, B2B portal, Amazon marketplace, showroom POS.")
System_Ext(paymentGateway, "Payment Gateway & Fraud Service", "Captures payments, runs fraud checks, processes refunds.")
System_Ext(taxService, "Tax Calculation Service", "Real-time jurisdictional tax rates & filings (e.g., TaxJar/Avalara).")
System_Ext(carriers, "Carrier & Logistics APIs", "UPS/FedEx/USPS; rate shopping, labels, tracking, hazmat docs.")
System_Ext(threePL, "3PL Provider", "Reno warehouse integration for inventory sync and fulfillment status.")
System_Ext(accountingSystem, "Accounting / GL System", "QuickBooks / NetSuite for GL, AP, AR, financial reporting.")
System_Ext(identityProvider, "Microsoft Entra ID", "SSO, RBAC, MFA for workforce access.")
System_Ext(observability, "Observability & Alerting Stack", "Azure Monitor, Application Insights, logging & alerting.")
System_Ext(vendorSystems, "Vendor Systems / EDI", "Phase 2: PO/ASN/invoice exchange with key suppliers.")

Rel(owner, erp, "Reviews dashboards, approves high-value POs & policy overrides")
Rel(opsManager, erp, "Manages warehouse tasks, shipping orchestration, KPIs")
Rel(purchasingLead, erp, "Plans replenishment, manages vendors, approves POs")
Rel(warehouseAssoc, erp, "Uses RF workflows for receiving, picking, cycle counts")
Rel(csr, erp, "Handles order edits, RMAs, customer communications")
Rel(ecomManager, erp, "Maintains product data, pricing, channel syndication")
Rel(accountant, erp, "Runs tax reports, reconciles ledgers, posts journals")
Rel(itAdmin, erp, "Configures modules, integrations, deployments")

Rel(b2bCustomer, salesChannels, "Places orders, checks status")
Rel(salesChannels, erp, "Submits orders, customer updates", "REST/Events")
Rel(erp, salesChannels, "Publishes catalog, pricing, inventory, order status", "REST/Events")

Rel(erp, paymentGateway, "Authorize/capture payments, refunds", "REST/HTTPS")
Rel(paymentGateway, erp, "Provide payment status & fraud results")

Rel(erp, taxService, "Calculate & commit taxes", "REST/HTTPS")
Rel(taxService, erp, "Return tax breakdowns, filing status")

Rel(erp, carriers, "Get rates, buy labels, send hazmat docs", "REST/HTTPS")
Rel(carriers, erp, "Return tracking events, delivery confirmations")

Rel(erp, threePL, "Push orders, inventory sync, ASNs", "API/EDI")
Rel(threePL, erp, "Return inventory levels, shipment updates")

Rel(erp, accountingSystem, "Post journal entries, invoices, AP bills", "API/ETL")
Rel(accountingSystem, erp, "Acknowledge postings, share balances")

Rel(erp, identityProvider, "Delegate authentication & RBAC", "OAuth2 / OIDC")

Rel(erp, observability, "Emit logs, metrics, traces")
Rel(observability, opsManager, "Operations dashboards & alerts")
Rel(observability, itAdmin, "Platform health alerts, runbooks")

Rel(erp, vendorSystems, "Send POs, receive ASNs & invoices (Phase 2)", "EDI/API")

@enduml
