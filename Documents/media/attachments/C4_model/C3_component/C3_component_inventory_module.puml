@startuml PineConePro_ERPIMS_C3_InventoryModule
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_WITH_LEGEND()

Person(warehouseAssoc, "Warehouse Associate", "Executes receiving, put-away, picking, cycle counts via RF")
Person(opsManager, "Operations Manager", "Configures zones, monitors KPIs, resolves exceptions")

Container_Boundary(invBoundary, "Inventory & Warehouse Module") {
  Component(invController, "InventoryController", "ASP.NET Core", "RF & UI endpoints for inventory transactions, bin lookup, adjustments")
  Component(invAppService, "InventoryApplicationService", "Application layer", "Coordinates RF workflows, validations, event orchestration")
  Component(invValidator, "InventoryValidator", "FluentValidation", "Validates bin, lot/serial, zone rules, user permissions")
  Component(receiveWorkflow, "Receiving Workflow", "Domain service", "Handles ASN matching, lot capture, quality holds")
  Component(putawayPolicy, "Put-away Policy Engine", "Rules engine", "Determines optimal bins based on capacity, hazmat, velocity")
  Component(pickingPolicy, "Picking Policy Engine", "Rules engine", "Supports wave, zone, batch picking strategies")
  Component(inventoryAggregate, "InventoryItem Aggregate", "Domain model", "Manages on-hand, reserved, ATP per location/bin")
  Component(lotAggregate, "Lot Aggregate", "Domain model", "Tracks lot attributes, expiry, supplier provenance")
  Component(serialAggregate, "Serial Aggregate", "Domain model", "Records serial lifecycle, warranty, customer assignment")
  Component(changeQueue, "InventoryTask Queue", "Workflow queue", "Queues tasks for RF devices (picklists, cycle counts)")
  Component(invRepository, "InventoryRepository", "EF Core repository", "Persists inventory, lot, serial, task aggregates")
  Component(invReadModel, "InventoryReadModel", "CQRS read store", "Provides ATP views, bin heatmaps, cycle count dashboards")
  Component(eventPublisher, "InventoryEventPublisher", "Event dispatcher", "Emits item-received, item-adjusted, transfer-completed")
  Component(analyticsEmitter, "OpsMetricsEmitter", "Telemetry", "Sends KPIs (inventory accuracy, throughput, dwell time)")
  Component(integrationGateway, "Integration Facades", "Adapters", "Interfaces with Orders, Purchasing, 3PL, Shipping modules")
  Component(cycleCountScheduler, "CycleCount Scheduler", "Background worker", "Generates cycle count tasks based on ABC frequency")
  Component(reorderSignal, "Replenishment Signal Service", "Domain service", "Computes reorder point breaches, triggers purchasing events")
}

ContainerDb(sqlDb, "Operational Database", "Azure SQL", "Inventory, lot, serial schemas")
Container(cache, "Redis Cache", "Azure Cache for Redis", "Bin-level snapshots, RF session state")
Container(queue, "Azure Service Bus", "Topics/Queues", "Inventory events and work queues")
Container(blob, "Document Store", "Azure Blob Storage", "Receiving documents, inspection photos")
System_Ext(orderModule, "Order Module", "Consumes ATP, triggers allocations/picks")
System_Ext(purchModule, "Purchasing Module", "Receives replenishment signals, ASN updates")
System_Ext(shippingModule, "Shipping Module", "Requests pick/pack data, updates dispatch")
System_Ext(productModule, "Product Module", "Provides SKU setup, kits, hazmat info")
System_Ext(threePL, "3PL Provider", "Syncs inventory, receiving, shipments")
System_Ext(rfDevices, "RF Handhelds / Tablets", "Consume tasks, submit scans (SPA offline mode)")
System_Ext(observability, "Observability Stack", "Metrics, logs, tracing")

Rel(warehouseAssoc, rfDevices, "Uses for scanning")
Rel(rfDevices, invController, "REST/JSON calls, WebSocket updates")
Rel(opsManager, invController, "Configure bins, review dashboards")

Rel(invController, invAppService, "Orchestrate workflow")
Rel(invAppService, invValidator, "Validate inputs")
Rel(invAppService, receiveWorkflow, "Match ASN, capture quality holds")
Rel(invAppService, putawayPolicy, "Recommend bins")
Rel(invAppService, pickingPolicy, "Generate pick waves")
Rel(invAppService, inventoryAggregate, "Update on-hand, reserved")
Rel(invAppService, lotAggregate, "Capture lot, expiry")
Rel(invAppService, serialAggregate, "Register serials")
Rel(inventoryAggregate, invRepository, "Persist state")
Rel(lotAggregate, invRepository, "Persist lot data")
Rel(serialAggregate, invRepository, "Persist serial data")
Rel(invRepository, sqlDb, "Save/load data")
Rel(invReadModel, sqlDb, "Materialized views")
Rel(invAppService, invReadModel, "Query ATP, heatmaps")
Rel(invAppService, cache, "Cache RF tasks, bin stats")
Rel(changeQueue, cache, "Store task state for RF devices")
Rel(invAppService, changeQueue, "Push tasks to RF queue")
Rel(rfDevices, changeQueue, "Pull next task (WebSocket/poll)")
Rel(invAppService, blob, "Attach inspection photos, docs")

Rel(integrationGateway, orderModule, "Reserve/release stock, provide picklists")
Rel(integrationGateway, purchModule, "Send replenishment, receive ASN")
Rel(integrationGateway, shippingModule, "Confirm picks, handoff to pack")
Rel(integrationGateway, productModule, "Use product weights, hazmat")
Rel(integrationGateway, threePL, "Sync stock levels, transfers")
Rel(queue, threePL, "Asynchronous inventory updates")
Rel(eventPublisher, queue, "Publish item-received, cyclecount-completed")
Rel(inventoryAggregate, eventPublisher, "Emit domain events")
Rel(lotAggregate, eventPublisher, "Emit lot events")
Rel(serialAggregate, eventPublisher, "Emit serial events")
Rel(queue, orderModule, "Notify ATP updates")
Rel(queue, purchModule, "Signal reorder thresholds")
Rel(queue, shippingModule, "Notify pick completion")
Rel(reorderSignal, queue, "Publish reorder events")
Rel(reorderSignal, purchModule, "Direct reorder suggestions")
Rel(cycleCountScheduler, queue, "Schedule cycle count tasks")
Rel(analyticsEmitter, observability, "Send metrics, alerts")
Rel(invAppService, analyticsEmitter, "Feed KPIs, SLA stats")
Rel(invController, observability, "Request/latency telemetry")
Rel(integrationGateway, observability, "Integration health logs")

@enduml
